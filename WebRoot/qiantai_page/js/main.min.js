/**
 * Created by whw-apple on 16/8/1.
 */
$(function(){
	
	/* Add by lee */
    $("#search_input").keyup(function(evt){
    	if (evt.keyCode == 13){
    		if ($("#search_input").val() == "") {
    			alert("请输入搜索关键词！");
    			return false;
    		}
    		window.location.href = ctxJS + "/searchAction.do?search="+encodeURI(encodeURI($("#search_input").val()));
		}
    });
    
    $(".fa-search").click(function(){
    	if ($("#search_input").val() == "") {
   			alert("请输入搜索关键词！");
   			return false;
   		}
    	window.location.href = ctxJS + "/searchAction.do?search="+encodeURI(encodeURI($("#search_input").val()));
    });
    
    if ($(".filter_cont ul").size() > 0){
        $(".filter_cont ul li.item_list span:not('.explore')").click(function(){
            $(this).addClass("active").siblings().removeClass("active");
        });
        $(".explore").click(function(){
           $(this).parent().parent().toggleClass("no_hidden");
        });
    }
    $(".like").click(function () {
        $(this).toggleClass("fa-heart-o");
    })
/*    
 * $(".subject_menu li").click(function () {
        window.location.href = 'project_list.html'
    })
*/
    if ($(".tabs").size() > 0){
        tabs(".tabs");
    }
    /*
    $(".login_btn").click(function(){
        window.location.href= "login.html";
    });
    */
    var login_html; 
    var tag = new Date().getMilliseconds();

    //set the user's information menu.2017-1-11.Tiger 
    //首页个人中心左边的用户头像-显示用户自己设置的头像  xh 2017-08-29
    var userimg=window.localStorage.getItem("userimg");
    var usersex=window.localStorage.getItem("usersex"); 
    if(userimg!=null && userimg !="1"){
    	 userimgurl=userimg;
    }else{
    	if(usersex==1){
    		 userimgurl=ctxJS + "/qiantai_page/img/user_avatar.jpg";
    	} else{
    		 userimgurl=ctxJS + "/qiantai_page/img/user_avatar1.png";
    	}
    }
    if (IndexDemo("userInfo") == 1 || IndexDemo("userInfo") == 38){
            login_html = '<span id="hide"><span class="avatar login"><img id="topUserAvatarId" src="' + userimgurl + '" /></span>' +
            '<a href="#" class="login_link">个人中心</a> | <a href="' + ctxJS + '/help.jsp">帮助</a>' +
            '<ul class="user_menu_list">' +
            
            '<li><a href="' + ctxJS +'/userInfo/userAbility.do">我的胜任力</a></li>' +
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do?mode=tab1">我的学习</a></li>' +
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do?mode=tab2">我的学分</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/userFav.do">我的收藏</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/myAccountManage.do">我的学习卡</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/MyCourse.do?mode=personal&xueke=99031">我的学科</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/myMessageManage.do">我的消息</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/studyRecordManage.do">学习档案</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/userAccount.do">账号管理</a></li>' +
            /*
            '<li><a href="#">我的胜任力</a></li>'+
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do">我的学习</a></li>' +
            '<li><a href="#">我的收藏</a></li>'+
            '<li><a href="#">我的学习卡</a></li>'+
            '<li><a href="#">我的学科</a></li>'+
            '<li><a href="#">我的消息</a></li>'+
            '<li><a href="#">学习档案</a></li>'+
            '<li><a href="' + ctxJS + '/userInfo/userAccount.do">账号管理</a></li>' +*/
            '<li class="top_border logout"><a href="###" onclick="window.localStorage.setItem(\'isLogin\',\'false\');location.href=\'' + ctxJS + '/logout.do?time=' + tag + '\'";>安全退出</a></li>' +
            '</ul>';
    }else{    	
     	login_html = '<span id="hide"><span class="avatar login"><img id="topUserAvatarId" src="' + userimgurl + '" /></span>' +
            '<a href="#" class="login_link">个人中心</a> | <a href="' + ctxJS + '/help.jsp" class="help">帮助</a>' +
            '<ul class="user_menu_list">' +
            
            '<li><a href="' + ctxJS +'/userInfo/userAbility.do">我的胜任力</a></li>' +
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do?mode=tab1">我的学习</a></li>' +
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do?mode=tab2">我的学分</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/userFav.do">我的收藏</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/myAccountManage.do">我的学习卡</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/MyCourse.do?mode=personal&xueke=99031">我的学科</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/myMessageManage.do">我的消息</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/studyRecordManage.do">学习档案</a></li>' +
            '<li><a href="' + ctxJS + '/userInfo/userAccount.do">账号管理</a></li>' +
            /*
            '<li><a href="#">我的胜任力</a></li>'+
            '<li><a href="' + ctxJS +'/userInfo/MyStudyManage.do">我的学习</a></li>' +
            '<li><a href="#">我的收藏</a></li>'+
            '<li><a href="#">我的学习卡</a></li>'+
            '<li><a href="#">我的学科</a></li>'+
            '<li><a href="#">我的消息</a></li>'+
            '<li><a href="#">学习档案</a></li>'+
            '<li><a href="' + ctxJS + '/userInfo/userAccount.do">账号管理</a></li>' +*/
            '<li class="top_border logout"><a href="###" onclick="window.localStorage.setItem(\'isLogin\',\'false\');location.href=\'' + ctxJS + '/logout.do?time=' + tag + '\'";>安全退出</a></li>' +
            '</ul>';
    }

    if (window.localStorage.getItem("isLogin") == "true"){
        $(".menu_bar .right_nav").empty().html(login_html);
        $(".header .top_cont .right_nav").empty().html(login_html);
    }
    var color;
    $('.login_link').mouseover(function(event){
    	color = $(this).css("color");
    	$(this).css("color", "#12bce1");
    	$(this).css("transition","all .3s ease-in-out");
    	$('.user_menu_list').css("display","block"); 
    	$('.user_menu_list').css("transition","all .3s ease-in-out");
    });
    $('.login_link').mouseout(function(event){
    	$(this).css("color", color); 
    });
    $('.help').mouseover(function(){
    	color = $(this).css("color");
    	$(this).css("color", "#12bce1"); 
    });

    $('.exit').mouseover(function(){
    	color = $(this).css("color");
    	$(this).css("color", "#12bce1"); 
    });
    $('.help').mouseout(function(){
    	$(this).css("color", color); 
    });
    $('.exit').mouseout(function(){
    	$(this).css("color", color); 
    });
    $('.user_menu_list').mouseover(function(event){
    	$('.user_menu_list').css("display","block"); 
    	$('.user_menu_list').css("transition","all .3s ease-in-out");
    });
    $('.user_menu_list').mouseout(function(event){
    	$('.user_menu_list').css("display","none"); 
    	$('.user_menu_list').css("position","absolute !important");
    	$('.user_menu_list').css("width","140px !important");
    	$('.user_menu_list').css("padding","10px 0");
    	$('.user_menu_list').css("background-color","#fff !important");
    	$('.user_menu_list').css("clear","both !important");
    	$('.user_menu_list').css("z-index","9999999999999 !important");
    	$('.user_menu_list').css("box-shadow","0 3px 3px #666");
    	$('.user_menu_list').css("float","none !important");
    	$('.user_menu_list').css("height","280px !important");
    	$('.user_menu_list').css("border","1px solid #ccc");
    	$('.login_click').css("color", "#666");
    });
});

function tabs(tabarea){
    $(tabarea + " .tab_list .tab").each(function(){
        $(this).click(function(){
            $(this).addClass("active").siblings().removeClass("active");
            var c_name = $(this).attr("id");
            $(tabarea + " .tab_cont." + c_name).show().siblings(".tab_cont").hide();
        });
    });
}
function IndexDemo(str2){
    var str1 = window.location.pathname;
    var s = str1.indexOf(str2);
    return(s);
}
// get url param
(function($){
    $.getUrlParam = function(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r!=null) return unescape(r[2]); return null;
    }
})(jQuery);